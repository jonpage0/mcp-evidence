# Evidence.dev MCP Server

A Model Context Protocol (MCP) server for working with Evidence.dev data sources.

## Overview

This MCP server provides an interface to query Evidence.dev data sources directly from MCP-compatible tools. It allows you to:

- List all data sources in an Evidence.dev project
- View table schemas for each data source
- Execute SQL queries on parquet files generated by Evidence.dev

The server is read-only and works with parquet files that are generated after running `pnpm run sources` in an Evidence.dev project.

## Features

- **SQL Reserved Word Support**: Properly handles table names containing SQL reserved words like "copy"
- **DuckDB Integration**: Uses DuckDB to efficiently query parquet files
- **Evidence.dev Project Structure**: Automatically discovers and maps the Evidence.dev directory structure
- **Read-only Mode**: Ensures data safety with read-only access to your Evidence data

## Requirements

- Python 3.10 or higher
- DuckDB 1.1.3 or higher
- MCP 1.0.0 or higher
- An Evidence.dev project with generated data (after running `pnpm run sources`)

## Installation

You can install the server using pip:

```bash
pip install mcp-server-duckdb
```

Or from the source code:

```bash
# Clone the repository
git clone https://github.com/your-username/mcp-server-duckdb.git
cd mcp-server-duckdb

# Install dependencies
pip install -e .
```

**Note:** If you encounter an error about DuckDB not being found, make sure to install it explicitly:

```bash
pip install duckdb>=1.1.3
```

## Usage

Run the server pointing to your Evidence.dev project:

```bash
mcp-server-duckdb --project-path /path/to/your/evidence/project
```

The server will automatically discover all data sources by reading the `.evidence/template/static/data` directory.

## MCP Tools and Resources

This server provides the following MCP tools:

- `evidence-list-sources`: List all Evidence.dev data sources
- `evidence-list-tables`: List all tables in a specific data source
- `evidence-describe-table`: Get schema information for a specific table
- `evidence-query`: Execute SQL queries on the parquet data

It also exposes each data source as an MCP resource with the URI format: `evidence://{source_name}`

## Example Queries

```sql
-- Query a specific table
SELECT * FROM maniac_neon_orders LIMIT 10

-- Join tables from different sources
SELECT 
    o.id, 
    o.total, 
    u.name 
FROM maniac_neon_orders o
JOIN maniac_neon_users u ON o.user_id = u.id
LIMIT 10

-- Query a table with a SQL reserved word in its name
SELECT * FROM "maniac_neon_prod_referral_codes copy" LIMIT 10
```

## Integrating with Cline/Roo-Cline

To use this MCP server with Cline or Roo-Cline, see the [MCP Integration Guide](mcp-integration-guide.md).

## Technical Notes

### SQL Reserved Words Handling

This server automatically handles SQL reserved words in table names by:

1. Properly quoting view names with double quotes when creating SQL views
2. Enabling queries to reference tables with SQL reserved words like "copy" in their names
3. Maintaining compatibility with Evidence.dev's naming conventions

Example of querying a table with a SQL reserved word:

```sql
SELECT * FROM "maniac_neon_prod_linked_cards copy" LIMIT 10
```

## Troubleshooting

If you encounter issues with the server, make sure:

1. You've run `pnpm run sources` in your Evidence.dev project to generate the parquet files
2. The project path provided to the server is correct
3. You have the required Python dependencies installed
4. If querying tables with SQL reserved words, ensure you use double quotes around the table name

## License

This project is licensed under the MIT License - see the LICENSE file for details.
